unit main;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, DBAccess, MyAccess, MemDS,
  Vcl.StdCtrls, Datasnap.DBClient, SimpleDS, Vcl.ComCtrls, ComObj;

type
  TForm1 = class(TForm)
    MyConnection1: TMyConnection;
    Edit1: TEdit;
    Label1: TLabel;
    Memo1: TMemo;
    Label2: TLabel;
    Edit2: TEdit;
    Label3: TLabel;
    Button1: TButton;
    MyQuery1: TMyQuery;
    MyTable1: TMyTable;
    OpenDialog1: TOpenDialog;
    RichEdit1: TRichEdit;
    Button2: TButton;
    Button3: TButton;
    ListBox1: TListBox;
    Label4: TLabel;
    procedure Button1Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    //procedure Button1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

type
  TSinonims = record
    id  : integer;
    parent : integer;
    txt: string[50];
end;


var
  Form1: TForm1;
  sin_mas: array of TSinonims;
  sin_file: file of TSinonims;
  sin_word: TSinonims;
  str: string; //рабочая строка
  str_rub: string; //строка с рубриками
  fl: integer; //флаг выхода из цикла обработки рубрик


implementation

{$R *.dfm}

{

работа со строками
st:=Copy(s,1,AnsiPos('#',s)-1);
Delete(s,1,AnsiPos('#',s));

//////

function DelDat(c:integer):integer;
begin

Reset(F);
 while not Eof(F) do
    begin
      read(F, DummyMember);
      Members[FilePos(F)-1]:=DummyMember;
      j:=FilePos(F);
    end;

Rewrite(F);     //очистка файла, перевод указателя на
                //начало первого компонента файла

for i:=0 to j-1 do
  begin
  if i=x then continue
   else
   begin
   Write(F, Members[i]);
   end;
  end;

end;

//////////

y:=0;  //проверка по файлу
AssignFile(F,s+'\psw.dat');
Reset(F);
 while not Eof(F) do
    begin
      read(F, DummyMember);
      if DummyMember.polz=s1 then y:=1;
    end;
CloseFile(F);

//////////////

if (y=0) then      //добавить в файл
   begin
    ComboBox1.Items.Add(s1);
    DummyMember.polz:=s1;
    DummyMember.sumxor:='';
    AssignFile(F,s+'\psw.dat');
    Reset(F);
    Seek(F,FileSize(F));
    write(F, DummyMember);
    CloseFile(F);
   end;

/////////////

AssignFile(F,s+'\psw.dat');
DelDat(x);
CloseFile(F);

unction DelDat(c:integer):integer;
begin

Reset(F);
 while not Eof(F) do
    begin
      read(F, DummyMember);
      Members[FilePos(F)-1]:=DummyMember;
      j:=FilePos(F);
    end;

Rewrite(F);     //очистка файла, перевод указателя на
                //начало первого компонента файла

for i:=0 to j-1 do
  begin
  if i=x then continue
   else
   begin
   Write(F, Members[i]);
   end;
  end;

end;


//////////////////////

procedure TForm1.FormShow(Sender: TObject);
var ss:string;
flag:boolean;
begin
AssignFile(F,s+'\psw.dat');
  flag:=true;
  Reset(F);
  while not Eof(F) do
      begin
      read(F, DummyMember);
      ADOQuery1.SQL.Clear;
      ADOQuery1.SQL.Add('select Polzovatel from Groups');
      ADOQuery1.SQL.Add('where Polzovatel="'+DummyMember.polz+'";');
      ADOQuery1.Open;
      if ADOQuery1.RecordCount=1 then
         begin
         ComboBox1.Items.Add(DummyMember.polz);
         end
         else
         begin
         Deldat(FilePos(F)-1);
         Reset(F);
         end;
      end;

ADOQuery1.SQL.Clear;
ADOQuery1.SQL.Add('select Polzovatel from Groups;');
ADOQuery1.Open;
AssignFile(F,s+'\psw.dat');
Reset(F);
for i:=0 to ADOQuery1.RecordCount-1 do
  begin
   ss:=ADOQuery1.FieldByName('Polzovatel').value;
   Reset(F);
   j:=0;
   while not Eof(F) do
      begin
      read(F, DummyMember);
      if ss=DummyMember.polz then begin j:=1; break; end;
      end;
   if j=0 then begin
               ComboBox1.Items.Add(ss);
               seek(F, FileSize(F));
               DummyMember.polz:=ss;
               DummyMember.sumxor:='';
               write(F,DummyMember);
               end;
   ADOQuery1.Next;
   end;
CloseFile(F);
end;

//////////////

вход по ентеру
procedure TForm2.Edit1KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
if ord(key)=13 then Button1.Click;
end;


}

procedure TForm1.Button1Click(Sender: TObject);
begin
//Удмуртия, в ленту, бюджет
//добавить в файл

//sin_word.id:=6;
//sin_word.parent:=3;
//sin_word.txt:='буджет';

AssignFile(sin_file,GetCurrentDir+'\Sinonims.dat');
Reset(sin_file);
Seek(sin_file,FileSize(sin_file));
write(sin_file, sin_word);
CloseFile(sin_file);

end;

procedure TForm1.Button3Click(Sender: TObject);
var COM_Word: olevariant;
begin
  try
    if OpenDialog1.Execute then
    begin
    Caption := ExtractFileName(OpenDialog1.FileName);
    COM_Word := CreateOLEObject('Word.Application');
    COM_Word.Visible := False;
    COM_Word.Documents.Open(OpenDialog1.FileName);
    Com_Word.ActiveDocument.Select;
    COM_Word.Selection.Copy;
    RichEdit1.PasteFromClipboard;
    COM_Word.DisplayAlerts := False;
    COM_Word.Quit;
    end;
  finally
    COM_Word := UnAssigned;
  end;

str:=RichEdit1.Lines.Text;
str_rub:=Copy(str,1,AnsiPos('[',str)-1);  //копируем все до зага
//showmessage(str_rub);
{Delete(str,1,AnsiPos('[',str));  //удаляем все до зага
Edit1.Text:=Copy(str,1,AnsiPos(']',str)-1);  //копируем заг

Delete(str,1,AnsiPos('[',str)); //удаляем заг
Memo1.Lines.Text:=Copy(str,1,AnsiPos(']',str)-1); //копируем тело

Delete(str,1,AnsiPos('[',str)); //удаляем тело
Edit2.Text:=Copy(str,1,AnsiPos(']',str)-1);  //копируем тэги }

fl:=0;
Repeat
 begin
  ListBox1.Items.Add(Copy(str_rub,1,AnsiPos(',',str_rub)-1));
  Delete(str_rub,1,AnsiPos(',',str_rub));
  if AnsiPos(',',str_rub)=0 then 
      begin
      fl:=1;
      ListBox1.Items.Add(Copy(str_rub,1,AnsiPos('.',str_rub)-1));
      Delete(str_rub,1,AnsiPos('.',str_rub));
      end;
 end;
until fl=1;
Showmessage(str_rub);

str_rub:=ListBox1.Items.Names[0];

fl:=0;  //поиск родителя по файлу
showmessage(GetCurrentDir+'\Sinonims.dat');
AssignFile(sin_file,GetCurrentDir+'\Sinonims.dat');
Reset(sin_file);
 while not Eof(sin_file) do
    begin
      read(sin_file, sin_word);
      if sin_word.txt=str_rub then begin fl:=sin_word.parent; break; end;
    end;

Reset(sin_file);
 while not Eof(sin_file) do
    begin
      read(sin_file, sin_word);
      if sin_word.id=fl then begin break; end;
    end;
    
CloseFile(sin_file);
showmessage(str_rub+'='+sin_word.txt);

end;

procedure TForm1.FormCreate(Sender: TObject);
var i:integer;
begin
//s:=GetCurrentDir;  //установелние текущего каталога
if FileExists('Sinonims.dat')=false then  //проверка наличия файла
  begin
    i:=FileCreate('Sinonims.dat');    //если нету то создать
    FileClose(i);              //и закрыть чтоб ошибок небыло
  end;
end;

procedure TForm1.FormDestroy(Sender: TObject);
begin
//sldb.Free;
end;

end.
